<!DOCTYPE html>
<html lang="tr">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Persistent Volumes</title>
  <meta property="og:title" content="Persistent Volumes" />
  <meta name="twitter:title" content="Persistent Volumes" />
  <meta name="description" content="Kubernetes persistent volumes by example">
  <meta property="og:description" content="Kubernetes persistent volumes by example">
  <meta name="twitter:description" content="Kubernetes persistent volumes by example">
  <meta name="author" content=""/>
  <link href='http://kubernetes.egitim.io/img/kbe-logo.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="http://kubernetes.egitim.io/img/kbe-logo.png" />
  <meta name="twitter:image" content="http://kubernetes.egitim.io/img/kbe-logo.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="http://kubernetes.egitim.io/pv/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Kubernetes Eğitimi" />

  <meta name="generator" content="Hugo 0.40.1" />
  <link rel="canonical" href="http://kubernetes.egitim.io/pv/" />
  <link rel="alternate" href="http://kubernetes.egitim.io/index.xml" type="application/rss+xml" title="Kubernetes Eğitimi">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="http://kubernetes.egitim.io/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="http://kubernetes.egitim.io/css/pygment_highlights.css" />
  <link rel="stylesheet" href="http://kubernetes.egitim.io/css/highlight.min.css" />
</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://kubernetes.egitim.io/">Ana Dizin</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Katkıda bulun!" href="https://github.com/ykocaman/kubernetes.egitim.io">Katkıda bulun!</a>
            </li>
          
        
          
            <li>
              <a title="Kendin dene!" href="/diy/">Kendin dene!</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Kubernetes Eğitimi" href="http://kubernetes.egitim.io/">
            <img class="avatar-img" src="http://kubernetes.egitim.io/img/kbe-logo.png" alt="Kubernetes Eğitimi" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="page-heading">
              <h1>Persistent Volumes</h1>
                
                  
                    <hr class="small">
                    <span class="page-subheading">Kubernetes persistent volumes by example</span>
                  
                
                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
  <div class="container" role="main">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p>A <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">persistent volume</a> (PV) is a cluster-wide resource that you can use to store data in a way that it persists beyond the lifetime of a pod. The PV is not backed by locally-attached storage on a worker node but by networked storage system such as EBS or NFS or a distributed filesystem like Ceph.</p>

<p>In order to use a PV you need to claim it first, using a persistent volume claim (PVC). The PVC requests a PV with your desired specification (size, speed, etc.) from Kubernetes and binds it then to a pod where you can mount it as a volume. So let&rsquo;s create such a <a href="https://github.com/openshift-evangelists/kbe/blob/master/specs/pv/pvc.yaml">PVC</a>, asking Kubernetes for 1 GB of storage using the default <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/">storage class</a>:</p>

<pre><code class="language-bash">$ kubectl apply -f https://raw.githubusercontent.com/openshift-evangelists/kbe/master/specs/pv/pvc.yaml

$ kubectl get pvc
NAME      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS    AGE
myclaim   Bound    pvc-27fed6b6-3047-11e9-84bb-12b5519f9b58   1Gi        RWO            gp2-encrypted   18m
</code></pre>

<p>To understand how the persistency plays out, let&rsquo;s create a <a href="https://github.com/openshift-evangelists/kbe/blob/master/specs/pv/deploy.yaml">deployment</a> that uses above PVC to mount it as a volume into <code>/tmp/persistent</code>:</p>

<pre><code class="language-bash">$ kubectl apply -f https://raw.githubusercontent.com/openshift-evangelists/kbe/master/specs/pv/deploy.yaml
</code></pre>

<p>Now we want to test if data in the volume actually persists. For this we find the pod managed by above deployment, exec into its main container and create a file called <code>data</code> in the <code>/tmp/persistent</code> directory (where we decided to mount the PV):</p>

<pre><code class="language-bash">$ kubectl get po
NAME                         READY   STATUS    RESTARTS   AGE
pv-deploy-69959dccb5-jhxx    1/1     Running   0          16m

$ kubectl exec -it pv-deploy-69959dccb5-jhxxw -- bash
bash-4.2$ touch /tmp/persistent/data
bash-4.2$ ls /tmp/persistent/
data  lost+found
</code></pre>

<p>It&rsquo;s time to destroy the pod and let the deployment launch a new pod. The expectation is that the PV is available again in the new pod and the data in <code>/tmp/persistent</code> is still present. Let&rsquo;s check that:</p>

<pre><code class="language-bash">$ kubectl delete po pv-deploy-69959dccb5-jhxxw
pod pv-deploy-69959dccb5-jhxxw deleted

$ kubectl get po
NAME                         READY   STATUS    RESTARTS   AGE
pv-deploy-69959dccb5-kwrrv   1/1     Running   0          16m

$ kubectl exec -it pv-deploy-69959dccb5-kwrrv -- bash
bash-4.2$ ls /tmp/persistent/
data  lost+found
</code></pre>

<p>And indeed, the <code>data</code> file and its content is still where it is expected to be.</p>

<p>Note that the default behavior is that even when the deployment is deleted, the PVC (and the PV) continues to exist. This storage protection feature helps avoiding data loss. Once you&rsquo;re sure you don&rsquo;t need the data anymore, you can go ahead and delete the PVC and with it eventually destroy the PV:</p>

<pre><code class="language-bash">$ kubectl delete pvc myclaim
persistentvolumeclaim &quot;myclaim&quot; deleted
</code></pre>

<p>The types of PV available in your Kubernetes cluster depend on the environment (on-prem or public cloud). Check out the <a href="https://stateful.kubernetes.sh/#storage">Stateful Kubernetes</a> reference site if you want to learn more about this topic.</p>

<p><a href="/volumes">Previous</a> | <a href="/secrets">Next</a></p>

        
      </div>
    </div>
  </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          
          &nbsp;&bull;&nbsp;
          2019

          
            &nbsp;&bull;&nbsp;
            <a href="http://kubernetes.egitim.io/">Kubernetes Eğitimi</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="http://kubernetes.egitim.io/js/main.js"></script>
<script src="http://kubernetes.egitim.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>






<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-34425776-2', 'auto');
ga('send', 'pageview');
</script>


  </body>
</html>

